<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title>XCECUTIVEFIVEID Community Hub</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            background-image: radial-gradient(at 80% 0%, hsla(218,100%,70%,0.3) 0px, transparent 50%),
                              radial-gradient(at 0% 100%, hsla(280,100%,80%,0.4) 0px, transparent 50%),
                              linear-gradient(to bottom right, #f0f2f5, #e0e7ed);
            background-repeat: no-repeat;
            background-attachment: fixed;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .main-content-wrapper, .main-menu-wrapper {
            width: 100%;
            max-width: 700px;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.5) inset;
            border: 1px solid rgba(224, 224, 224, 0.6);
        }
        .animate-initial-load {
            opacity: 0;
            transform: translateY(30px) scale(0.95);
            animation: fadeInPopUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes fadeInPopUp {
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .hidden { display: none; }
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            text-decoration: none;
            color: white;
            letter-spacing: 0.5px;
        }
        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
        }
        .btn-primary {
            background-color: #6366f1;
            background-image: linear-gradient(to right, #6366f1, #8b5cf6);
        }
        .btn-secondary {
            background-color: #6b7280;
            background-image: linear-gradient(to right, #6b7280, #9ca3af);
        }
        .btn-social {
            background-color: #374151;
            color: white;
            font-size: 0.9rem;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.4s ease-out;
            pointer-events: none;
        }
        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background-color: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            max-width: 550px;
            width: 90%;
            text-align: center;
            transform: translateY(-50px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #9ca3af;
            transition: all 0.2s;
        }
        .modal-close-btn:hover {
            color: #6b7280;
            transform: rotate(90deg);
        }
        /* Other styles from previous version */
        .form-group{margin-bottom:20px}label{display:block;margin-bottom:8px;font-weight:600;color:#333}input[type=text],input[type=date],select,textarea{width:100%;padding:14px;border:1px solid #cfd8dc;border-radius:12px;font-size:1rem;color:#374151;transition:border-color .3s ease,box-shadow .3s ease;box-sizing:border-box;background-color:#f8fafd}input[type=text]:focus,input[type=date]:focus,select:focus,textarea:focus{outline:0;border-color:#6366f1;box-shadow:0 0 0 5px rgba(99,102,241,.3)}.radio-group{display:flex;flex-wrap:wrap;gap:20px;margin-top:5px}.radio-group label{display:flex;align-items:center;font-weight:400;cursor:pointer}.radio-group input[type=radio]{width:auto;margin-right:8px;accent-color:#6366f1;transform:scale(1.2)}.rules-section{max-height:60vh;overflow-y:auto;padding-right:15px;margin-bottom:20px;line-height:1.7;color:#4b5563;text-align:left}.rules-section h3{font-size:1.5rem;font-weight:600;color:#1f2937;margin-top:25px;margin-bottom:15px}.rules-section ol{list-style-position:inside;padding-left:5px}.rules-section li{margin-bottom:10px}.agreement-checkbox-group{display:flex;align-items:flex-start;margin-top:20px;padding-top:20px;border-top:1px solid #e5e7eb}.agreement-checkbox-group input[type=checkbox]{margin-top:5px;margin-right:12px;width:20px;height:20px;accent-color:#6366f1}.agreement-checkbox-group label{font-weight:500;cursor:pointer;color:#1f2937;text-align:left;flex:1}#faceDetectionContainer{text-align:center}#webcamVideo{width:100%;max-width:400px;height:auto;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,.2);background-color:#000;margin:20px auto;display:block;border:4px solid #cfd8dc;transition:border-color .5s ease-in-out}#faceDetectionMessage{margin-top:15px;font-size:1.1rem;color:#4b5563;font-weight:500}#scratchCardWrapper{position:relative;width:100%;max-width:450px;margin:0 auto;height:200px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.15);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#scratchCanvas{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:16px;cursor:grab;pointer-events:auto}#scratchCanvas:active{cursor:grabbing}#hiddenContent{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:#fff;border-radius:16px;padding:20px}#secretPassword{text-align:center;font-size:1.2rem;padding:12px}#verifyPasswordButton{width:auto;padding:10px 24px;font-size:1rem;margin-top:15px}.loading-spinner{border:4px solid rgba(255,255,255,.4);border-left-color:#fff;border-radius:50%;width:28px;height:28px;animation:spin 1s linear infinite;display:inline-block;vertical-align:middle;margin-right:10px}.qr-code-container{margin-top:20px;display:inline-block}
    </style>
</head>
<body>

    <!-- Main Menu -->
    <div id="mainMenu" class="main-menu-wrapper">
        <div class="container text-center space-y-6 animate-initial-load">
            <div>
                <h1 class="text-4xl font-extrabold text-gray-800 tracking-wider">XCECUTIVEFIVEID</h1>
                <p class="text-gray-500">Since 2017</p>
            </div>
            
            <div class="space-y-4">
                <button id="isiBiodataBtn" class="btn btn-primary text-lg">ISI BIODATA X5</button>
                <button id="changeNickBtn" class="btn btn-primary text-lg">CHANGE NICKNAME</button>
                <button id="websiteBtn" class="btn btn-primary text-lg">WEBSITE</button>
            </div>

            <div>
                <p class="text-gray-600 font-semibold mb-4">@follow us sosial media</p>
                <div class="grid grid-cols-2 gap-4">
                    <a href="https://facebook.com/contoh" target="_blank" class="btn btn-social">Facebook</a>
                    <a href="https://instagram.com/contoh" target="_blank" class="btn btn-social">Instagram</a>
                </div>
                <a href="https://whatsapp.com/channel/contoh" target="_blank" class="btn btn-social mt-4">Channel Whatsapp</a>
            </div>

            <footer class="pt-6 border-t border-gray-200 text-sm text-gray-500">
                <p>2017-2025 XFIVECommunity. All rights reserved.</p>
            </footer>
        </div>
    </div>

    <!-- Registration Form Wrapper (Initially Hidden) -->
    <div id="formWrapper" class="main-content-wrapper hidden">
        <div class="container">
            <!-- All previous form steps will be injected here by JS -->
        </div>
    </div>

    <!-- All Modals -->
    <!-- Registration Success Modal -->
    <div id="notificationModalOverlay" class="modal-overlay">
        <div class="modal-content">
            <button id="modalCloseBtn" class="modal-close-btn">&times;</button>
            <h3 id="modalTitle" class="text-2xl font-bold mb-4"></h3>
            <p id="modalMessage" class="text-gray-600 mb-6"></p>
            <div id="modalQrCodeContainer" class="qr-code-container"></div>
            <div class="mt-5 flex flex-col sm:flex-row gap-4 justify-center">
                <a id="downloadQrButton" class="btn btn-primary hidden" style="width:auto; padding: 10px 20px;" download="qr-code-x5.png">Download QR</a>
                <button id="modalResetFormButton" class="btn btn-secondary">Isi Formulir Lagi</button>
            </div>
        </div>
    </div>

    <!-- Change Nickname Modal -->
    <div id="changeNickModalOverlay" class="modal-overlay">
        <div class="modal-content">
            <button id="changeNickModalCloseBtn" class="modal-close-btn">&times;</button>
            <h3 class="text-2xl font-bold mb-4">Ganti Nickname</h3>
            <p class="text-gray-600 mb-6">Pilih tester yang akan Anda hubungi untuk proses ganti nickname.</p>
            <div class="form-group">
                <select id="testerSelectChangeNick" class="w-full p-3 border rounded-lg bg-gray-50">
                    <option value="">-- Pilih Tester --</option>
                    <!-- Options will be populated by JS -->
                </select>
            </div>
            <!-- UPDATED QR SECTION FOR CHANGE NICKNAME -->
            <div id="changeNickQrSection" class="hidden mt-6">
                <div class="flex flex-col sm:flex-row items-center justify-center gap-6">
                    <div id="changeNickQrContainer" class="qr-code-container mt-0"></div>
                    <div class="text-center sm:text-left">
                        <p class="font-semibold text-lg mb-2">Scan Sekarang</p>
                        <a id="downloadChangeNickQrBtn" class="btn btn-primary inline-block" style="width:auto; padding: 12px 24px;" download>Download QR</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Website "Coming Soon" Modal -->
    <div id="comingSoonModalOverlay" class="modal-overlay">
        <div class="modal-content">
             <button id="comingSoonModalCloseBtn" class="modal-close-btn">&times;</button>
             <h3 class="text-2xl font-bold mb-4">Segera Hadir!</h3>
             <p class="text-gray-600">Website kami sedang dalam pengembangan. Nantikan fitur-fitur menarik lainnya!</p>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- All Element Selectors ---
        const mainMenu = document.getElementById('mainMenu');
        const formWrapper = document.getElementById('formWrapper');
        const formContainer = formWrapper.querySelector('.container');
        
        // Main Menu Buttons
        const isiBiodataBtn = document.getElementById('isiBiodataBtn');
        const changeNickBtn = document.getElementById('changeNickBtn');
        const websiteBtn = document.getElementById('websiteBtn');

        // Modals
        const changeNickModalOverlay = document.getElementById('changeNickModalOverlay');
        const comingSoonModalOverlay = document.getElementById('comingSoonModalOverlay');
        
        // --- Data (Eza Removed) ---
        const testerData = {
            "Ramsky": "6285693393707", "Fadel": "6282173876492",
            "Fajar": "6287750639436", "Thomas": "6281374402822",
            "Joko": "6289514915776", "Citra": "6283825756494",
            "Mey": "6287704534610", "Vandhu": "6281371412119",
            "Ardiansyah": "6287745673345", 
            "Wale": "6282276260740", "Zarah": "6281342620907"
        };
        const googleAppsScriptURL = 'https://script.google.com/macros/s/AKfycbwEUL4YkEYBfaIl1-T2jYueJorhn5SyS2q1YLpse5bhlleULPXIy3TjnwkputvVm156gg/exec';

        // --- HTML Templates for Dynamic Content ---
        const formStepsHTML = `
            <button id="backToMenuBtn" class="mb-4 text-indigo-600 font-semibold hover:underline">&larr; Kembali ke Menu</button>
            <!-- Rules Section -->
            <div id="rulesContainer">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Peraturan Komunitas X5</h2>
                <div class="rules-section">
                    <p>Tujuan dibuat aturan yang sangat ketat untuk kepentingan bersama. Kami berkomitmen ingin menciptakan komunitas ini nyaman dan aman untuk siapa saja. Pastikan baca peraturan ini sebelum memulai diskusi.</p>
                    <h3>PERATURAN UMUM UNTUK SEMUA ANGGOTA</h3>
                    <ol class="list-decimal">
                        <li>Menjunjung tinggi etika, adab dan sopan santun kepada semua anggota.</li>
                        <li>Dilarang berdiskusi mendiskriminasi agama dan ras tertentu. Hindari juga berdiskusi sara, dan politik. [SP/BANNED]</li>
                        <li>Hindari melepas tittle ''X5'' tanpa persetujuan moderator/staff. [SP/BANNED]</li>
                        <li>Hindari sebisa mungkin mengirim gambar / video / audio berbau ponografi, obat obat an, dan kekerasan (jika terpaksa, silahkan blur bagian tersebut). [SP/BANNED]</li>
                        <li>Hindari memancing kerusuhan, kericuhan, keonaran yang mengatasnamakan XFIVE. [SP/BANNED]</li>
                        <li>Jika ada masalah sesama anggota harap konfirmasi moderator/admin biar lebih jelas perkaranya . jangan main out sendiri karna petinggi juga akan mengambil jalan keluarnya. [SP]</li>
                        <li>Dilarang membawa masalah personal ke dalam grup XFIVE. apabila melakukannya akan di beri peringatan dan jika terulang kembali kick out. [SP/BANNED]</li>
                        <li>Berpacaran sesama anggota boleh saja, asal jika ada masalah dengan hubungan kalian. Tolong jangan di campur adukkan ke community karena efeknya besar sekali terhadap anggota lain. [SP]</li>
                        <li>Diwajibkan menyapa sesama anggota XFIVE ( X5! )</li>
                        <li>Dilarang menggunakan program ilegal (cheat) disaat club battle / merugikan orang lain. [SP/BANNED]</li>
                        <li>Khusus member yang sudah bergabung divisi club, Dilarang meganti ke com. [SP]</li>
                        <li>Dilarang chatting antar member yang belum dikenal dan membuat risih kepada sesama member grup [SP/BANNED]</li>
                        <li>Menaati pada peraturan komunitas Ayodance (<a href="http://ayodance.megaxus.com/v1/page/rules" target="_blank" class="text-blue-600 hover:underline">http://ayodance.megaxus.com/v1/page/rules</a>)</li>
                    </ol>
                    <h3>KEBIJAKAN PRIVASI</h3>
                    <p>Kebijakan Privasi ini adalah komitmen dari XFIVE untuk menghargai dan melindungi setiap data atau informasi pribadi. Kebijakan Privasi ini menetapkan dasar atas perolehan, pengumpulan, pengolahan, dan atau segala bentuk pengelolaan yang terkait.</p>
                </div>
                <div class="agreement-checkbox-group">
                    <input type="checkbox" id="agreeToRules">
                    <label for="agreeToRules">Saya menyetujui semua syarat, ketentuan, dan kebijakan privasi yang berlaku.</label>
                </div>
                <button type="button" id="continueButton" class="btn btn-primary mt-4" disabled>Lanjutkan</button>
            </div>
            <!-- Face Detection Section -->
            <div id="faceDetectionContainer" class="hidden"><h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Pendeteksi Wajah</h2><p class="text-center text-gray-600 mb-4">Untuk verifikasi, kami perlu akses kamera Anda. Tidak ada data wajah yang disimpan.</p><video id="webcamVideo" autoplay muted playsinline></video><p id="faceDetectionMessage" class="text-center">Menunggu akses kamera...</p><button type="button" id="startWebcamButton" class="btn btn-primary mt-4">Mulai Deteksi</button><button type="button" id="continueToFormButton" class="btn btn-primary mt-4" disabled>Lanjutkan</button></div>
            <!-- Scratch Card Section -->
            <div id="scratchCardContainer" class="hidden"><h2 class="text-3xl font-bold text-center text-gray-800 mb-2">Verifikasi Final!</h2><p class="text-gray-600 mb-6 text-center">Gosok area di bawah ini!</p><div id="scratchCardWrapper"><canvas id="scratchCanvas"></canvas><div id="hiddenContent"><label for="secretPassword" class="font-semibold text-gray-700 mb-2">Kata Sandi:</label><input type="text" id="secretPassword" placeholder="..."><button type="button" id="verifyPasswordButton" class="btn btn-primary">Verifikasi</button><p id="passwordError" class="text-red-500 text-sm mt-1 hidden">Salah!</p></div></div></div>
            <!-- Member Registration Form -->
            <div id="memberFormContainer" class="hidden"><h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Formulir Pendataan Member</h1><form id="memberForm"><div class="form-group"><label for="namaPanggilan">Nama Panggilan:</label><input type="text" id="namaPanggilan" name="namaPanggilan" required></div><div class="form-group"><label for="nicknameAyodance">Nickname Ayodance:</label><input type="text" id="nicknameAyodance" name="nicknameAyodance" required></div><div class="form-group"><label for="tanggalLahir">Tanggal Lahir:</label><input type="date" id="tanggalLahir" name="tanggalLahir" required></div><div class="form-group"><label for="domisili">Domisili:</label><input type="text" id="domisili" name="domisili" required></div><div class="form-group"><label>Punya Sosial Media?</label><div class="radio-group"><label><input type="radio" name="hasSocialMedia" value="Ya"> Ya</label><label><input type="radio" name="hasSocialMedia" value="Tidak" checked> Tidak</label></div><div id="socialMediaInputContainer" class="mt-3 hidden"><label for="sosialMediaName">Nama Sosial Media:</label><input type="text" id="sosialMediaName" name="sosialMediaName"></div></div><div class="form-group"><label for="divisiCommunity">Divisi:</label><select id="divisiCommunity" name="divisiCommunity" required><option value="">Pilih</option><option value="Club">Club</option><option value="Com">Com</option></select></div><div class="form-group"><label for="tester">Pilih Tester:</label><select id="tester" name="tester" required><option value="">Pilih</option></select></div><button type="submit" id="submitButton" class="btn btn-primary"><span id="buttonText">Kirim Data</span><span id="loadingSpinner" class="loading-spinner hidden"></span></button></form></div>
        `;
        
        // --- Functions ---
        function showMainMenu() {
            formWrapper.classList.add('hidden');
            mainMenu.classList.remove('hidden');
        }

        function showForm() {
            mainMenu.classList.add('hidden');
            formWrapper.classList.remove('hidden');
            formContainer.innerHTML = formStepsHTML;
            initializeFormLogic();
        }

        function initializeFormLogic() {
            // Re-select all elements within the newly injected form
            const backToMenuBtn = document.getElementById('backToMenuBtn');
            const rulesContainer = document.getElementById('rulesContainer');
            const faceDetectionContainer = document.getElementById('faceDetectionContainer');
            const scratchCardContainer = document.getElementById('scratchCardContainer');
            const memberFormContainer = document.getElementById('memberFormContainer');
            const agreeToRulesCheckbox = document.getElementById('agreeToRules');
            const continueButton = document.getElementById('continueButton');
            const webcamVideo = document.getElementById('webcamVideo');
            const faceDetectionMessage = document.getElementById('faceDetectionMessage');
            const startWebcamButton = document.getElementById('startWebcamButton');
            const continueToFormButton = document.getElementById('continueToFormButton');
            const scratchCanvas = document.getElementById('scratchCanvas');
            const scratchCardWrapper = document.getElementById('scratchCardWrapper');
            const verifyPasswordButton = document.getElementById('verifyPasswordButton');
            const passwordInput = document.getElementById('secretPassword');
            const passwordError = document.getElementById('passwordError');
            const memberForm = document.getElementById('memberForm');
            const submitButton = document.getElementById('submitButton');
            const buttonText = document.getElementById('buttonText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const socialMediaYes = document.querySelector('input[name="hasSocialMedia"][value="Ya"]');
            const socialMediaNo = document.querySelector('input[name="hasSocialMedia"][value="Tidak"]');
            const socialMediaInputContainer = document.getElementById('socialMediaInputContainer');
            const testerSelect = document.getElementById('tester');
            
            // Modal elements for form
            const notificationModal = {
                overlay: document.getElementById('notificationModalOverlay'),
                title: document.getElementById('modalTitle'),
                message: document.getElementById('modalMessage'),
                qrContainer: document.getElementById('modalQrCodeContainer'),
                downloadBtn: document.getElementById('downloadQrButton'),
                resetBtn: document.getElementById('modalResetFormButton')
            };

            // Populate tester dropdown
            Object.keys(testerData).forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                testerSelect.appendChild(option);
            });

            // --- Event Listeners for Form Steps ---
            backToMenuBtn.addEventListener('click', showMainMenu);
            agreeToRulesCheckbox.addEventListener('change', () => { continueButton.disabled = !agreeToRulesCheckbox.checked; });
            continueButton.addEventListener('click', () => {
                rulesContainer.classList.add('hidden');
                faceDetectionContainer.classList.remove('hidden');
            });
            startWebcamButton.addEventListener('click', async () => {
                startWebcamButton.disabled = true; faceDetectionMessage.textContent = 'Memulai kamera...';
                try {
                    const mediaStream = await navigator.mediaDevices.getUserMedia({ video: true });
                    webcamVideo.srcObject = mediaStream; await webcamVideo.play();
                    faceDetectionMessage.textContent = 'Kamera aktif. Mencari wajah...';
                    webcamVideo.style.borderColor = '#f59e0b';
                    setTimeout(() => {
                        faceDetectionMessage.textContent = 'Wajah Terdeteksi!';
                        webcamVideo.style.borderColor = '#10b981';
                        continueToFormButton.disabled = false;
                    }, 3000);
                } catch (err) {
                    faceDetectionMessage.textContent = 'Gagal mengakses kamera.';
                    webcamVideo.style.borderColor = '#ef4444'; startWebcamButton.disabled = false;
                }
            });
            continueToFormButton.addEventListener('click', () => {
                if (webcamVideo.srcObject) webcamVideo.srcObject.getTracks().forEach(track => track.stop());
                faceDetectionContainer.classList.add('hidden');
                scratchCardContainer.classList.remove('hidden');
            });
            
            // Scratch Card Logic
            if (scratchCanvas) {
                const ctx = scratchCanvas.getContext('2d'); let isScratching = false;
                const setupCanvas = () => {
                    scratchCanvas.width = scratchCardWrapper.clientWidth; scratchCanvas.height = scratchCardWrapper.clientHeight;
                    const gradient = ctx.createLinearGradient(0,0,scratchCanvas.width,scratchCanvas.height);
                    gradient.addColorStop(0, '#8b5cf6'); gradient.addColorStop(1, '#6366f1');
                    ctx.fillStyle = gradient; ctx.fillRect(0,0,scratchCanvas.width,scratchCanvas.height);
                    ctx.fillStyle = 'rgba(255,255,255,0.8)'; ctx.font = 'bold 24px "Inter"';
                    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                    ctx.fillText('GOSOK DI SINI', scratchCanvas.width/2, scratchCanvas.height/2);
                    ctx.globalCompositeOperation = 'destination-out';
                };
                const getPos = (e) => ({ x: (e.clientX||e.touches[0].clientX) - scratchCanvas.getBoundingClientRect().left, y: (e.clientY||e.touches[0].clientY) - scratchCanvas.getBoundingClientRect().top });
                const scratch = (e) => { if(!isScratching) return; e.preventDefault(); const pos = getPos(e); ctx.beginPath(); ctx.arc(pos.x,pos.y,30,0,Math.PI*2,false); ctx.fill(); };
                const reveal = () => { scratchCanvas.style.pointerEvents = 'none'; scratchCanvas.style.transition = 'opacity 0.5s'; scratchCanvas.style.opacity = '0'; };
                const start = (e) => { isScratching = true; scratch(e); };
                const end = () => { if(!isScratching) return; isScratching = false; reveal(); };
                window.addEventListener('resize', setupCanvas);
                scratchCanvas.addEventListener('mousedown', start); scratchCanvas.addEventListener('mouseup', end);
                scratchCanvas.addEventListener('mouseleave', end); scratchCanvas.addEventListener('mousemove', scratch);
                scratchCanvas.addEventListener('touchstart', start, {passive:false}); scratchCanvas.addEventListener('touchend', end);
                scratchCanvas.addEventListener('touchmove', scratch, {passive:false});
                setupCanvas();
            }

            verifyPasswordButton.addEventListener('click', () => {
                if (passwordInput.value.trim().toUpperCase() === 'X5') {
                    scratchCardContainer.classList.add('hidden');
                    memberFormContainer.classList.remove('hidden');
                } else {
                    passwordError.classList.remove('hidden');
                }
            });

            // Form Submission Logic
            socialMediaYes.addEventListener('change', () => { socialMediaInputContainer.classList.remove('hidden'); socialMediaInputContainer.querySelector('input').required = true; });
            socialMediaNo.addEventListener('change', () => { socialMediaInputContainer.classList.add('hidden'); socialMediaInputContainer.querySelector('input').required = false; });
            memberForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                submitButton.disabled = true; buttonText.textContent = 'Mengirim...'; loadingSpinner.classList.remove('hidden');
                const formData = new FormData(memberForm);
                const data = Object.fromEntries(formData.entries());
                data.type = 'registration';
                if (data.hasSocialMedia === 'Tidak') data.sosialMediaName = 'Tidak ada';
                
                try {
                    await fetch(googleAppsScriptURL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
                    const testerName = data.tester;
                    const qrValue = `https://wa.me/${testerData[testerName]}`;
                    const successMessage = `Terima kasih, <strong>${data.namaPanggilan}</strong>! Data Anda berhasil dikirim. Silakan scan QR ini untuk menghubungi tester kalian.`;
                    
                    notificationModal.title.textContent = 'Pendaftaran Berhasil!';
                    notificationModal.message.innerHTML = successMessage;
                    notificationModal.qrContainer.innerHTML = '';
                    const qrCanvas = document.createElement('canvas');
                    notificationModal.qrContainer.appendChild(qrCanvas);
                    new QRious({ element: qrCanvas, value: qrValue, size: 200 });
                    notificationModal.downloadBtn.href = qrCanvas.toDataURL('image/png');
                    notificationModal.downloadBtn.download = `qr-code-x5-${data.namaPanggilan}.png`;
                    notificationModal.downloadBtn.classList.remove('hidden');
                    notificationModal.overlay.classList.add('show');
                    memberFormContainer.classList.add('hidden');
                } catch (error) {
                    console.error('Error submitting form:', error);
                    notificationModal.title.textContent = 'Terjadi Kesalahan';
                    notificationModal.message.innerHTML = 'Maaf, data Anda gagal dikirim. Silakan coba lagi nanti.';
                    notificationModal.overlay.classList.add('show');
                } finally {
                    submitButton.disabled = false; buttonText.textContent = 'Kirim Data'; loadingSpinner.classList.add('hidden');
                }
            });
            notificationModal.resetBtn.addEventListener('click', () => {
                notificationModal.overlay.classList.remove('show');
                showMainMenu();
            });
        }

        // --- Main Menu Event Listeners ---
        isiBiodataBtn.addEventListener('click', showForm);
        websiteBtn.addEventListener('click', () => comingSoonModalOverlay.classList.add('show'));
        
        // Change Nickname Modal Logic (FIXED)
        const testerSelectChangeNick = document.getElementById('testerSelectChangeNick');
        const changeNickQrSection = document.getElementById('changeNickQrSection');
        const changeNickQrContainer = document.getElementById('changeNickQrContainer');
        const downloadChangeNickQrBtn = document.getElementById('downloadChangeNickQrBtn');
        Object.keys(testerData).forEach(name => {
            const option = document.createElement('option');
            option.value = name; option.textContent = name;
            testerSelectChangeNick.appendChild(option);
        });
        
        changeNickBtn.addEventListener('click', () => {
            testerSelectChangeNick.value = '';
            changeNickQrSection.classList.add('hidden');
            changeNickModalOverlay.classList.add('show');
        });
        testerSelectChangeNick.addEventListener('change', function() {
            const testerName = this.value;
            if (!testerName) {
                changeNickQrSection.classList.add('hidden');
                return;
            }
            const phone = testerData[testerName];
            const message = encodeURIComponent("halo saya ingin meganti nickname.\n\nNick Awal :\nNick Ganti :\n\nTerimakasih");
            const qrValue = `https://wa.me/${phone}?text=${message}`;
            
            changeNickQrContainer.innerHTML = '';
            const qrCanvas = document.createElement('canvas');
            changeNickQrContainer.appendChild(qrCanvas);
            new QRious({ element: qrCanvas, value: qrValue, size: 160 }); // Adjusted size for layout

            downloadChangeNickQrBtn.href = qrCanvas.toDataURL('image/png');
            downloadChangeNickQrBtn.download = `qr-ganti-nick-${testerName}.png`;
            
            changeNickQrSection.classList.remove('hidden');
        });

        // Modal Close Buttons
        document.querySelectorAll('.modal-close-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('.modal-overlay').classList.remove('show');
            });
        });
    });
    </script>
</body>
</html>
